<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="瞎bb的私密小天地，羞"><title>Kubernetes on AWS | 做正确的事</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Lato"></head><body><!-- gallery that comes before the header--><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a><a href="/about" class="sidebar-nav-item">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/AWS/">AWS</a><a class="post-tag-link" href="/tags/kubernetes/">kubernetes</a></div><div class="post-time">2018-08-30</div></div></div><div class="container post-header"><h1>Kubernetes on AWS</h1></div><div class="container post-content"><p>在AWS上安装kubernetes遇到了挺多问题的，主要是网络问题，受限于aws的各种安全机制。</p>
<p>推荐使用kops安装。新版本安装可以使用local模式，不需要对dns做额外配置。如果用非local模式，需要配合route 53，并创建一个域名用来绑定kubernetes集群。这里的域名可以是internal也可以是external。</p>
<p>如果是使用自定义的域名，要注意dns更新的机制。虽然aws route 53的dns更新是很快的，但是ttl默认设置的时间还是很长的，貌似要两天。所以如果改了dns，可能要两天才能生效，或者提前修改ttl，然后再更改dns。</p>
<p>还是local的模式好用，不需要配置dns，kops使用aws的elb做网关。</p>
<p>接下来要解决的问题是vpc。aws上不同的应用可能属于不同的vpc，不同的vpc之间是不能互相访问的。比如生产的数据库的vpc=sg-01，而kubernetes自己的vpc=sg-02。这时候kubernetes内的pod是无法访问DB的。</p>
<p>这里需要再vpc中加入peer connection，将两个vpc合并起来，并在各自vpc的route table上加上对方的路由解析。最后需要enable dns解析！我就是这一步漏掉了，导致pod无法访问db。理论上这时候pod就可以访问不同vpc的db了。</p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>